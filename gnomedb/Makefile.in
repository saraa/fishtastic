APIS=           gnomedb-api.xml

INCLUDE_APIS = 	../atk/atk-api.xml 	\
		../pango/pango-api.xml 	\
		../art/art-api.xml	\
		../gdk/gdk-api.xml 	\
		../gdk/gdk-symbols.xml	\
		../gtk/gtk-api.xml	\
		../gtk/gtk-symbols.xml	\
		../gnome/gnome-api.xml	\
		../gda/gda-api.xml

RUNTIME=mono
MCS=mcs
ASSEMBLY=gnomedb-sharp.dll

@ENABLE_GNOMEDB_TRUE@ all: $(ASSEMBLY)
@ENABLE_GNOMEDB_FALSE@ all: 

generated-stamp: $(APIS) ../generator/gapi_codegen.exe GnomeDb.metadata
	$(RUNTIME) ../parser/gapi-fixup.exe --api=gnomedb-api.xml --metadata=GnomeDb.metadata && \
	$(RUNTIME) ../generator/gapi_codegen.exe --generate $(APIS) 	\
	--include $(INCLUDE_APIS) --outdir=generated --customdir=.	\
	--assembly-name=gnomedb-sharp && touch generated-stamp

$(ASSEMBLY): *.cs generated-stamp
	$(MCS) --unsafe --target library 	\
	-r ../glib/glib-sharp.dll -r ../pango/pango-sharp.dll 	\
	-r ../atk/atk-sharp.dll -r ../art/art-sharp.dll 	\
	-r ../gdk/gdk-sharp.dll -r ../gtk/gtk-sharp.dll 	\
	-r ../gnome/gnome-sharp.dll -r ../gda/gda-sharp.dll 	\
	-o $(ASSEMBLY) --recurse '*.cs'

clean:
	rm -f generated-stamp
	rm -f $(ASSEMBLY)
	rm -rf generated

prefix=@prefix@
DESTDIR=
apidir=$(DESTDIR)$(prefix)/share/gapi
libdir=$(DESTDIR)$(prefix)/lib

install: all
@ENABLE_GNOMEDB_TRUE@	../mkinstalldirs $(libdir) &&		\
@ENABLE_GNOMEDB_TRUE@	../mkinstalldirs $(apidir) &&		\
@ENABLE_GNOMEDB_TRUE@	for i in $(APIS); do                    \
@ENABLE_GNOMEDB_TRUE@		cp $$i $(apidir) || true;       \
@ENABLE_GNOMEDB_TRUE@	done && 				\
@ENABLE_GNOMEDB_TRUE@	cp $(ASSEMBLY) $(libdir)
